<div id="page-title">
	<div id="page-meta">
		<div class="aux-actions">
			<a class="btn btn-default btn-outline" ng-click="ngCtrl.deleteListModal()"><i class="fa fa-trash-o go-red"></i> Delete list</a>
		</div>
		<div class="meta-label">
			<h4><span class="go-gray">Records' list:</span> {{ngCtrl.list.name}}</h4>
		</div>
	</div>

</div>
<div id="page-body" style="padding-bottom:3em; ">
	<div class="tabbable tabs-left spilled">
		<a class="back" href="#/admin/entities/{{::ngCtrl.entity.name}}/lists"><i class="fa fa-fw fa-arrow-left"></i> <span class="text">Back</span></a>
		<ul class="nav nav-tabs">
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}"><i class="fa fa-fw fa-info-circle"></i> <span class="text">Details</span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/fields"><i class="fa fa-fw fa-table"></i> <span class="text">Fields</span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/views"><i class="fa fa-fw fa-file-text-o"></i> <span class="text">Record Views</span></a></li>
			<li class="active"><a href="#/admin/entities/{{::ngCtrl.entity.name}}/lists"><i class="fa fa-fw fa-list"></i> <span class="text">Records Lists</span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/trees"><i class="fa fa-fw fa-sitemap"></i> <span class="text">Records Trees</span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/relations"><i class="fa fa-fw fa-link"></i> <span class="text">Relations</span></a></li>
		</ul>

	</div>
	<div id="page-text">
		<nav class="navbar navbar-default navbar-erp">
			<div class="container-fluid">
				<ul class="nav navbar-nav">
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/lists/{{::ngCtrl.list.name}}">Basic Attributes</a>
					</li>
					<li role="presentation" class="active">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/lists/{{::ngCtrl.list.name}}/columns">Columns</a>
					</li>
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/lists/{{::ngCtrl.list.name}}/query-sort">Query & Sort</a>
					</li>
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/lists/{{::ngCtrl.list.name}}/actions">Actions</a>
					</li>
				</ul>
			</div>
		</nav>
		<div class="view-manage-section">
			<div class="row">
				<div class="col-xs-6">
					<h5>Selected columns <small class="go-gray">| Record Id is always injected in the data. The first column is also the default search column</small></h5>
				</div>
				<div class="col-xs-6">
					<h5>Library</h5>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-6">
					<div class="list-field-selection-box" style="height:250px;">
						<div class="drop-zone">
							<div as-sortable="ngCtrl.dragLibraryListeners" ng-model="ngCtrl.list.columns">
								<div class="dropped-item" ng-model="item" data-as-sortable-item ng-repeat="item in ngCtrl.list.columns track by item.dataName"
									 ng-switch="::item.type">
									<div ng-switch-when="field" class="clearfix">
										<i class="fa fa-fw fa-arrows go-gray pull-left" as-sortable-item-handle></i>
										<a href="javascript:void(0)" class="pull-right" ng-click="ngCtrl.moveToLibrary(item, $index)"><i class="fa fa-fw fa-arrow-right"></i></a>
										<i class="fa fa-fw fa-table go-teal" style="margin-left:10px;"></i> {{::item.meta.name}} <i class="fa fa-fw fa-eye-slash go-red" ng-show="$index + 1 > ngCtrl.list.visibleColumnsCount"></i>
										<i class="fa fa-database go-gray text-small tooltip-btn" tooltip-append-to-body="true" uib-tooltip-template="'dataBindTemplate.html'" tooltip-trigger="outsideClick" tooltip-placement="right" tooltip-class="wva-tooltip"></i>
										<span class="note go-green" ng-show="ngCtrl.defaultFieldName == item.meta.name">(default search)</span>
									</div>
									<div ng-switch-when="fieldFromRelation" class="clearfix">
										<i class="fa fa-fw fa-arrows go-gray pull-left" as-sortable-item-handle></i>
										<a href="javascript:void(0)" class="pull-right" ng-click="ngCtrl.moveToLibrary(item, $index)"><i class="fa fa-fw fa-arrow-right"></i></a>
										<i class="fa fa-fw fa-table go-teal" style="margin-left:10px;"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}} <i class="fa fa-fw fa-eye-slash go-red" ng-show="$index + 1 > ngCtrl.list.visibleColumnsCount"></i>
									</div>
									<div ng-switch-when="view" class="clearfix">
										<i class="fa fa-fw fa-arrows go-gray pull-left" as-sortable-item-handle></i>
										<a href="javascript:void(0)" class="pull-right" ng-click="ngCtrl.moveToLibrary(item, $index)"><i class="fa fa-fw fa-arrow-right"></i></a>
										<i class="fa fa-fw fa-file-text-o go-teal" style="margin-left: 10px;"></i> {{::item.meta.name}} <i class="fa fa-fw fa-eye-slash go-red" ng-show="$index + 1 > ngCtrl.list.visibleColumnsCount"></i>
									</div>
									<div ng-switch-when="viewFromRelation" class="clearfix">
										<i class="fa fa-fw fa-arrows go-gray pull-left" as-sortable-item-handle></i>
										<a href="javascript:void(0)" class="pull-right" ng-click="ngCtrl.moveToLibrary(item, $index)"><i class="fa fa-fw fa-arrow-right"></i></a>
										<i class="fa fa-fw fa-file-text-o go-teal" style="margin-left: 10px;"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}} <i class="fa fa-fw fa-eye-slash go-red" ng-show="$index + 1 > ngCtrl.list.visibleColumnsCount"></i>
									</div>
									<div ng-switch-when="list" class="clearfix">
										<i class="fa fa-fw fa-arrows go-gray pull-left" as-sortable-item-handle></i>
										<a href="javascript:void(0)" class="pull-right" ng-click="ngCtrl.moveToLibrary(item, $index)"><i class="fa fa-fw fa-arrow-right"></i></a>
										<i class="fa fa-fw fa-list go-teal" style="margin-left: 10px;"></i> {{::item.meta.name}} <i class="fa fa-fw fa-eye-slash go-red" ng-show="$index + 1 > ngCtrl.list.visibleColumnsCount"></i>
									</div>
									<div ng-switch-when="listFromRelation" class="clearfix">
										<i class="fa fa-fw fa-arrows go-gray pull-left" as-sortable-item-handle></i>
										<a href="javascript:void(0)" class="pull-right" ng-click="ngCtrl.moveToLibrary(item, $index)"><i class="fa fa-fw fa-arrow-right"></i></a>
										<i class="fa fa-fw fa-list go-teal" style="margin-left:10px;"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}} <i class="fa fa-fw fa-eye-slash go-red" ng-show="$index + 1 > ngCtrl.list.visibleColumnsCount"></i>
									</div>
									<div ng-switch-when="treeFromRelation" class="clearfix">
										<i class="fa fa-fw fa-arrows go-gray pull-left" as-sortable-item-handle></i>
										<a href="javascript:void(0)" class="pull-right" ng-click="ngCtrl.moveToLibrary(item, $index)"><i class="fa fa-fw fa-arrow-right"></i></a>
										<i class="fa fa-fw fa-sitemap go-teal" style="margin-left:10px;"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}} <i class="fa fa-fw fa-eye-slash go-red" ng-show="$index + 1 > ngCtrl.list.visibleColumnsCount"></i>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-xs-6">
					<form class="form" style="margin-bottom:1em;padding:0;background:transparent;border:none;">
						<div class="form-group">
							<div class="input-group">
								<span class="input-group-addon"><i class="fa fa-fw fa-search"></i></span>
								<input type="text" ng-model="ngCtrl.search.dataName" class="form-control" style="width:100%;">
							</div>
						</div>
					</form>
					<div style="height:200px;overflow-y:scroll;">
						<div class="drop-zone-disabled">
							<div as-sortable="ngCtrl.dragControlListeners" ng-model="ngCtrl.library.items">
								<div class="dropped-item" ng-model="item" data-as-sortable-item
									 ng-repeat="item in ngCtrl.library.items | filter: ngCtrl.search track by item.dataName"
									 ng-switch="::item.type">
									<div as-sortable-item-handle ng-switch-when="field" class="clearfix">
										<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
										<i class="fa fa-fw fa-table go-teal" style="margin-left:10px;"></i> {{::item.meta.name}}
									</div>
									<div as-sortable-item-handle ng-switch-when="fieldFromRelation" class="clearfix">
										<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
										<i class="fa fa-fw fa-table go-teal" style="margin-left:10px;"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}
									</div>
									<div as-sortable-item-handle ng-switch-when="view" class="clearfix">
										<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
										<i class="fa fa-fw fa-file-text-o go-teal" style="margin-left: 10px;"></i> {{::item.meta.name}}
									</div>
									<div as-sortable-item-handle ng-switch-when="viewFromRelation" class="clearfix">
										<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
										<i class="fa fa-fw fa-file-text-o go-teal" style="margin-left: 10px;"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}
									</div>
									<div as-sortable-item-handle ng-switch-when="list" class="clearfix">
										<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
										<i class="fa fa-fw fa-list go-teal" style="margin-left: 10px;"></i> {{::item.meta.name}}
									</div>
									<div as-sortable-item-handle ng-switch-when="listFromRelation" class="clearfix">
										<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
										<i class="fa fa-fw fa-list go-teal" style="margin-left:10px;"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}
									</div>
									<div as-sortable-item-handle ng-switch-when="treeFromRelation" class="clearfix">
										<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
										<i class="fa fa-fw fa-sitemap go-teal" style="margin-left:10px;"></i> <span class="go-gray">{{::item.relationName}}<span class="divider">></span></span>{{::item.meta.name}}
									</div>
									<div as-sortable-item-handle ng-switch-when="html" class="clearfix">
										<div ng-if='item.tag == ""'>
											<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
											<i class="fa fa-fw fa-code go-teal" style="margin-left:10px;"></i> No tag
										</div>
										<div ng-if='item.tag != ""'>
											<a href="javascript:void(0)" class="pull-left" ng-click="ngCtrl.moveToColumns(item, $index)"><i class="fa fa-fw fa-arrow-left"></i></a>
											<i class="fa fa-fw fa-code go-teal" style="margin-left:10px;"></i> {{::item.tag}}
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<br />
					<table class="table table-bordered">
						<thead>
							<tr>
								<th class="go-bkg-white">relations</th>
								<th width="90" class="go-bkg-white">in library</th>
								<th width="115" class="go-bkg-white">direction</th>
							</tr>
						</thead>
						<tbody>
							<tr ng-repeat="relation in ngCtrl.library.relations track by relation.relationId">
								<td>
									<div style="overflow-x: hidden; -ms-text-overflow: ellipsis; -o-text-overflow: ellipsis; text-overflow: ellipsis;">
										<span ng-show="::ngCtrl.getRelationType(relation.relationId) == 1" class="badge badge-primary badge-inverse ng-hide" title="One to One" style="margin-right:5px;font-size:10px;">1 : 1</span>
										<span ng-show="::ngCtrl.getRelationType(relation.relationId) == 2" class="badge badge-primary badge-inverse ng-hide" title="One to Many" style="margin-right:5px;font-size:10px;">1 : N</span>
										<span ng-show="::ngCtrl.getRelationType(relation.relationId) == 3" class="badge badge-primary badge-inverse ng-hide" title="Many to Many" style="margin-right:5px;font-size:10px;">N : N</span>
										{{::relation.relationName}}
									</div>
								</td>
								<td>
									<a ng-click="ngCtrl.toggleRelationToLibrary(relation)" href="javascript:void(0)" style="color:#2196F3 !important">
										<span class="ng-hide" ng-show="relation.addedToLibrary">remove</span>
										<span class="ng-hide" ng-show="!relation.addedToLibrary">add</span>
									</a>
								</td>
								<td>
									<span class="go-gray" ng-if="!relation.sameOriginTargetEntity" title="only when the origin and target entity is the same in a relation, you can manage the direction">origin ! = target</span>
									<a ng-click="ngCtrl.changeRelationDirection(relation)" href="javascript:void(0)" style="color:#2196F3 !important" ng-if="relation.sameOriginTargetEntity">
										<span class="ng-hide" ng-show="relation.direction == 'origin-target'">origin > target</span>
										<span class="ng-hide" ng-show="relation.direction == 'target-origin'"><span class="go-red">target</span> > origin</span>
									</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

			</div>

		</div>

	</div>
</div>

<script type="text/ng-template" id="deleteListModal.html">
	<div class="modal-header" id="modal-top">
		<button type="button" class="close" ng-click="popupCtrl.cancel('cancel')" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<h3 class="modal-title">Delete a list</h3>
	</div>
	<div class="modal-body">
		<div class="alert alert-danger" ng-bind="popupCtrl.errorMessage" ng-show="popupCtrl.hasError"></div>
		<div ng-hide="popupCtrl.hasError">
			<p>Are you sure that you need this list deleted?</p>
		</div>
	</div>
	<div class="modal-footer">
		<button class="btn btn-danger" ng-click="popupCtrl.ok()" ng-hide="popupCtrl.hasError">Delete List</button>
		<button class="btn btn-default" ng-click="popupCtrl.cancel()">Cancel</button>
	</div>
</script>


<script type="text/ng-template" id="dataBindTemplate.html">
	<div class="tooltip-description">You can get this field data in a dynamic template by:</div>
	<div class="tooltip-databind"><span>{</span>{templateData[0].{{item.dataName}}<span>}</span>}</div>
	<div class="tooltip-description">[0] is the index of the record in the list. List meta is accessible via:</div>
	<div class="tooltip-databind"><span>{</span>{templateMeta<span>}</span>}</div>
</script>

<script type="text/ng-template" id="deleteListModal.html">
	<div class="modal-header" id="modal-top">
		<button type="button" class="close" ng-click="popupCtrl.cancel('cancel')" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<h3 class="modal-title">Delete a list</h3>
	</div>
	<div class="modal-body">
		<div class="alert alert-danger" ng-bind="popupCtrl.errorMessage" ng-show="popupCtrl.hasError"></div>
		<div ng-hide="popupCtrl.hasError">
			<p>Are you sure that you need this list deleted?</p>
		</div>
	</div>
	<div class="modal-footer">
		<button class="btn btn-danger" ng-click="popupCtrl.ok()" ng-hide="popupCtrl.hasError">Delete List</button>
		<button class="btn btn-default" ng-click="popupCtrl.cancel()">Cancel</button>
	</div>
</script>