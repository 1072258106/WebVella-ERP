<div id="page-title">
	<div id="page-meta">
		<div class="aux-actions">
		</div>
		<div class="meta-label">
			<h4><span class="go-gray">View name: </span> {{ngCtrl.view.name}}</h4>
		</div>
	</div>
</div>
<div id="page-body" ng-mousedown="ngCtrl.viewCheckMouseButton($event)">
	<div class="tabbable tabs-left spilled">
		<a class="back" href="#/admin/entities/{{::ngCtrl.entity.name}}/views"><i class="fa fa-fw fa-arrow-left"></i> <span class="text">Back</span></a>
		<ul class="nav nav-tabs">
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}"><i class="fa fa-fw fa-info-circle"></i> <span class="text">Details</span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/fields"><i class="fa fa-fw fa-table"></i> <span class="text">Fields</span></a></li>
			<li class="active"><a href="#/admin/entities/{{::ngCtrl.entity.name}}/views"><i class="fa fa-fw fa-file-text-o"></i> <span class="text">Record Views</span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/lists"><i class="fa fa-fw fa-list"></i> <span class="text">Records Lists</span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/trees"><i class="fa fa-fw fa-sitemap"></i> <span class="text">Records Trees</span></a></li>
			<li><a href="#/admin/entities/{{::ngCtrl.entity.name}}/relations"><i class="fa fa-fw fa-link"></i> <span class="text">Relations</span></a></li>
		</ul>

	</div>

	<div id="page-text">
		<nav class="navbar navbar-default navbar-erp">
			<div class="container-fluid">
				<ul class="nav navbar-nav">
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}">Basic Attributes</a>
					</li>
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}/form">Main Form</a>
					</li>
					<li role="presentation">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}/sidebar">Sidebar Forms</a>
					</li>
					<li role="presentation" class="active">
						<a href="#/admin/entities/{{::ngCtrl.entity.name}}/views/{{::ngCtrl.view.name}}/actions">Actions</a>
					</li>
				</ul>
			</div>
		</nav>

		<h4 style="margin-bottom:1em">Service javascript</h4>
		<p>Click the button below to review or manage the script that is used with the action templates.</p>
		<a class="btn btn-default btn-outline" href="javascript:void(0)" ng-click="ngCtrl.manageServiceCodeModal()">Manage Code</a>
		<span class="divider">|</span>
		<span class="ng-hide" ng-show="!ngCtrl.view.serviceCode">status: <span class="go-green">the default service code is loaded</span></span>
		<span class="ng-hide" ng-show="ngCtrl.view.serviceCode">status: <span class="go-orange">custom service code is loaded</span></span>

		<h4 style="margin-bottom:1em;margin-top:2em;">Action templates</h4>
		<p>Here are defined what actions the user can perform with the view or its fields.</p>
		<a class="btn btn-default btn-outline" href="javascript:void(0)" ng-click="ngCtrl.addManageActionItemModal(null)">Add New</a>
		<table class="table table-bordered table-hover table-vertical-align-middle ng-hide" style="margin-top:1em;" ng-show="ngCtrl.view.actionItems.length > 0">
			<thead>
				<tr>
					<th width="30"></th>
					<th width="200">menu</th>
					<th width="30"> weight</th>
					<th>name</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="actionItem in ngCtrl.view.actionItems track by actionItem.name">
					<td><a class="btn btn-default btn-outline"  href="javascript:void(0)" ng-click="ngCtrl.addManageActionItemModal(actionItem)"><i class="fa fa-fw fa-pencil"/></a></td>
					<td ng-bind="actionItem.menu"></td>
					<td ng-bind="actionItem.weight"></td>
					<td ng-bind="actionItem.name"></td>
				</tr>
			</tbody>
		</table>
	</div>
</div>


<script type="text/ng-template" id="manageServiceCodeModal.html">
	<div class="modal-header" id="modal-top">
		<button type="button" class="close" ng-click="popupCtrl.cancel('cancel')" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<h3 class="modal-title">Manage Service Code</h3>
	</div>
	<div class="modal-body">
		<p>Leave <b>empty</b> for the default service to be loaded. If you want to customize it, <a href="javascript:void(0)" ng-click="popupCtrl.loadDefaultScript()">click here</a> to prefill with the current default code.</p>
		<div ui-ace="popupCtrl.aceOptions" ng-model="popupCtrl.serviceCode" style="height:400px;"></div>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-click="popupCtrl.ok()" ng-hide="popupCtrl.hasError">Save</button>
		<button class="btn btn-default" ng-click="popupCtrl.cancel()">Cancel</button>
	</div>
</script>

<script type="text/ng-template" id="addManageActionItemModal.html">
	<div class="modal-header" id="modal-top">
		<button type="button" class="close" ng-click="popupCtrl.cancel('cancel')" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<h3 class="modal-title" ng-if="popupCtrl.isEdit">Manage Action template</h3>
		<h3 class="modal-title" ng-if="!popupCtrl.isEdit">Add Action template</h3>
	</div>
	<div class="modal-body">
		<form class="form form-horizontal" name="formName">
			<div class="form-group">
				<div class="row">
					<label class="control-label col-sm-2 required">Name</label>
					<div class="col-sm-6">
						<input ng-model="popupCtrl.actionItem.name" name="name" type="text" class="form-control" id="itemName" placeholder="e.g. print_record"
							   required pattern="^[a-z](?!.*__)[a-z0-9_]*[a-z0-9]$" maxlength="50" ng-model-options="{allowInvalid:true}">
						<ng-messages for="formName.name.$error" ng-if="formName.name.$touched && formName.name.$dirty && formName.name.$invalid || popupCtrl.nameError">
							<ng-message when="required" class="error">required field</ng-message>
							<ng-message when="pattern" class="error">only lowercase alphanumeric characters or underscore, must start with a letter, at least two chars</ng-message>
							<ng-message when="maxlength" class="error">must be less than 50 chars</ng-message>
						</ng-messages>
						<small class="error ng-hide" ng-show="popupCtrl.nameError">
							{{popupCtrl.nameMessage}}
						</small>
						<div class="description ng-hide" ng-show="!popupCtrl.nameError">should be unique for this view</div>						
					</div>
					<label class="control-label col-sm-1">Weight</label>
					<div class="col-sm-3">
						<input ng-model="popupCtrl.actionItem.weight" type="number" class="form-control" id="weight" name="weight" placeholder="e.g. 2"
							   required pattern="^\d+(\.\d{1,5})?$" ng-model-options="{allowInvalid:true}">
						<ng-messages for="formName.weight.$error" ng-if="formName.weight.$touched && formName.weight.$dirty && formName.weight.$invalid || popupCtrl.weightError">
							<ng-message when="required" class="error">required field</ng-message>
							<ng-message when="pattern" class="error">weight should be a positive integer or decimal number, with two decimal places after the dot</ng-message>
						</ng-messages>
						<small class="error ng-hide" ng-show="popupCtrl.weightError">
							{{popupCtrl.weightMessage}}
						</small>
					</div>
				</div>
			</div>
			<div class="form-group">
				<div class="row">
					<label class="control-label col-sm-2">Menu</label>
					<div class="col-sm-6">
						<select class="form-control" ng-model="popupCtrl.actionItem.menu" ng-change="popupCtrl.menuChanged()"
						ng-options="option.value as option.key for option in popupCtrl.menuOptions"></select>
					</div>
				</div>
			</div>
			<div class="form-group">
				<div class="row">
					<label class="control-label col-sm-2">Template</label>
					<div class="col-sm-10">
						<div ui-ace="popupCtrl.aceOptions" ng-model="popupCtrl.actionItem.template" style="height:100px;"></div>						
					</div>
				</div>
			</div>
		</form>
	</div>
	<div class="modal-footer">
		<button ng-if="popupCtrl.isEdit" class="btn btn-link pull-left go-red" ng-click="popupCtrl.delete()">[ Delete ]</button>
		<button class="btn btn-primary" ng-click="popupCtrl.ok()" ng-hide="popupCtrl.hasError" ng-if="popupCtrl.isEdit">Save</button>
		<button class="btn btn-success" ng-click="popupCtrl.ok()" ng-hide="popupCtrl.hasError" ng-if="!popupCtrl.isEdit">Add</button>
		<button class="btn btn-default" ng-click="popupCtrl.cancel()">Cancel</button>
	</div>
</script>
