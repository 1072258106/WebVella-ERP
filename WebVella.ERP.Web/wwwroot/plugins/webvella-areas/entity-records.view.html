<div id="page-title">
	<div id="page-meta">
		<div class="aux-actions">
			<a class="btn btn-success btn-sm hidden-xs ng-hide" ng-show="contentData.checkEntityPermissions('canCreate')"
			   href="#/areas/{{::contentData.currentArea.name}}/{{::contentData.entity.name}}/create?listName={{::contentData.stateParams.listName}}&filter={{::contentData.stateParams.filter}}&page={{::contentData.stateParams.page}}">
				<i class="fa fa-fw fa-plus"></i> Add New
			</a>

			<div class="form-group form-group-sm hidden-xs " ng-if="::contentData.defaultSearchField != null">
				<div class="left-inner-addon">
					<i class="fa fa-search"></i>
					<input ng-model="contentData.searchQuery" type="text" class="form-control" placeholder="{{::contentData.searchQueryPlaceholder}}" ng-keydown="contentData.checkForSearchEnter($event)">
				</div>
			</div>
			<span uib-dropdown class="dropdown">
				<a class="btn btn-default btn-sm" uib-dropdown-toggle><i class="fa fa-fw fa-bars"></i></a>
				<ul class="dropdown-menu pull-right" uib-dropdown-menu style="margin-top:10px;">
					<li ng-show="contentData.checkEntityPermissions('canCreate,canUpdate')">
						<a ng-click="contentData.openImportModal()">
							<i class="fa fa-upload"></i> Import CSV
						</a>
					</li>
					<li>
						<a ng-click="contentData.openExportModal()">
							<i class="fa fa-download"></i> Export CSV
						</a>
					</li>
					<li class="divider"></li>
					<li>
						<a href="/#/admin/entities/{{::contentData.entity.name}}/lists/{{::contentData.stateParams.listName}}">
							<i class="fa fa-wrench"></i> Edit List
						</a>
					</li>
				</ul>
			</span>
		</div>
		<div class="meta-label">
			<h4>
				{{::contentData.currentListView.label}}
				<span uib-dropdown on-toggle="toggled(open)" ng-if="contentData.generalLists.length > 1">
					<a uib-dropdown-toggle href="javascript:void(0)" class="selector btn btn-sm btn-outline"><i class="fa fa-fw fa-caret-down"></i></a>
					<ul class="dropdown-menu" uib-dropdown-menu>
						<li><a href="javascript:void(0)"><i class="fa fa-fw fa-thumb-tack go-red"></i> set current as default</a></li>
						<li class="ng-hide"><a href="javascript:void(0)"><span class="go-grey">This is your default list</span></a></li>
						<li class="divider"></li>
						<li ng-repeat="list in contentData.generalLists track by $index">
							<a href="#/areas/{{::contentData.currentArea.name}}/{{::contentData.entity.name}}/{{::list.name}}/all/1">
								<i class="fa fa-fw fa-{{list.iconName}}"></i> {{::list.label}}
							</a>
						</li>
					</ul>
				</span>
			</h4>
		</div>
	</div>
	<div id="page-messages" class="hide">
		<div class="alert alert-warning" role="alert">This is a plug-in message dynamically embedded in the page</div>
	</div>
</div>
<div id="page-body">

	<div id="page-text">
		<div class="table-scroll-wrapper" data-double-scroll-bar-horizontal>
			<table class="table table-bordered table-hover table-vertical-align-middle ng-hide {{::contentData.recordsMeta.cssClass}}" ng-show='::contentData.records.length > 0' ng-if="!contentData.recordsMeta.dynamicHtmlTemplate">
				<thead>
					<tr>
						<th class="actions text-center" style="padding:0;vertical-align:middle">
							<a class="btn btn-link btn-sm" style="color:#999" href="javascript:void(0)"  ng-click="show_filter = !show_filter">
								  <i class="fa fa-fw fa-filter go-grey ng-hide" ng-show="!show_filter"></i>
								  <i class="fa fa-fw fa-times go-red ng-hide" ng-show="show_filter"></i>
							</a>
						</th>
						<th class="wv-{{::column.meta.name}}" ng-repeat="column in contentData.recordsMeta.columns | limitTo: contentData.recordsMeta.visibleColumnsCount">{{::column.meta.label}}</th>
					</tr>
				</thead>
				<tbody>
					<tr style="background:#ddd" class="ng-hide" ng-show="show_filter">
						<td>
							<a class="btn btn-default btn-sm">
								<i class="fa fa-fw fa-filter"></i>
							</a>
						</td>
						<td>
							<input class="form-control"/>
						</td>
						<td>
							<input class="form-control"/>
						</td>
						<td>
							<select class="form-control"/>
						</td>
						<td>
							<span style="color:#999">from relation</span>
						</td>
						<td>
							<span style="color:#999">from relation</span>
						</td>
					</tr>
					<tr ng-repeat="record in contentData.records">
						<td class="actions">
							<a ng-click="contentData.saveStateParamsToSessionStorage()" href='#/areas/{{::contentData.currentArea.name}}/{{::contentData.entity.name}}/{{::record.id}}/{{::contentData.generateViewName(record)}}/*/*' class="btn btn-default btn-sm">
								<i class="fa fa-fw fa-eye"></i>
							</a>
						</td>
						<td class="wv-{{::column.meta.name}}" ng-repeat="column in contentData.recordsMeta.columns | limitTo: contentData.recordsMeta.visibleColumnsCount">
							<div ng-if="::contentData.currentUserHasReadPermission(column)" ng-switch="::column.type">
								<div ng-switch-when="field">
									<div ng-bind-html="::contentData.renderFieldValue(record[column.dataName],column.meta)"></div>
								</div>
								<div ng-switch-when="fieldFromRelation">
									<div ng-bind-html="::contentData.renderFieldValue(record[column.dataName],column.meta)"></div>
								</div>
								<div ng-switch-when="view">
									<recursive-view view-meta="::column" view-data="::record[column.dataName]" relations-list="::contentData.relationsMeta"></recursive-view>
								</div>
								<div ng-switch-when="viewFromRelation">
									<recursive-view view-meta="::column" view-data="::record[column.dataName]" relations-list="::contentData.relationsMeta"></recursive-view>
								</div>
								<div ng-switch-when="list">
									<recursive-list list-meta="::column" list-data="::record[column.dataName]" relations-list="::contentData.relationsMeta"></recursive-list>
								</div>
								<div ng-switch-when="listFromRelation">
									<recursive-list list-meta="::column" list-data="::record[column.dataName]" relations-list="::contentData.relationsMeta"></recursive-list>
								</div>
							</div>
							<div ng-if="::!contentData.currentUserHasReadPermission(column)">
								<span class="go-gray"><i class="fa fa-fw fa-lock"></i> hidden</span>
							</div>
						</td>
					</tr>
				</tbody>
			</table>

			<div class="ng-hide" ng-show='::contentData.records.length > 0' ng-if="contentData.recordsMeta.dynamicHtmlTemplate">
				<dynamic-list template-url="contentData.recordsMeta.dynamicHtmlTemplate" template-data="contentData.records" template-meta="contentData.recordsMeta"></dynamic-list>
			</div>
		</div>

		<div class="alert alert-info ng-hide" ng-show='::contentData.records.length == 0'>
			There are no records matching your query
		</div>

		<ul class="pager ng-hide" ng-hide="::contentData.currentPage == 1 && contentData.currentListView.pageSize > contentData.records.length" ng-if="::contentData.currentListView.pageSize != 0">
			<!--<li ng-if="::contentData.currentPage == 1" class="disabled previous"><a href="javascript:void(0)"><i class="fa fa-fw fa-chevron-left"></i> Previous</a></li>-->
			<li ng-if="::contentData.currentPage != 1" class="previous"><a href="javascript:void(0)" ng-click="contentData.selectPage(contentData.currentPage - 1, $event)"><i class="fa fa-fw fa-chevron-left"></i> Previous</a></li>
			<li ng-if="::contentData.currentListView.pageSize <= contentData.records.length" class="next"><a href="javascript:void(0)" ng-click="contentData.selectPage(contentData.currentPage + 1, $event)">Next <i class="fa fa-fw fa-chevron-right"></i></a></li>
			<!--<li ng-if="::contentData.currentListView.pageSize > contentData.records.length" class="disabled next"><a href="javascript:void(0)">Next <i class="fa fa-fw fa-chevron-right"></i></a></li>-->
		</ul>
	</div>
</div>

<script type="text/ng-template" id="exportModalContent.html">
	<div class="modal-header">
		<h4 class="modal-title">Export records</h4>
	</div>
	<div class="modal-body ng-hide" ng-show="!popupData.downloadFilePath">
		<div class="alert alert-danger ng-hide" ng-show="popupData.hasError" ng-bind="popupData.errorMessage"></div>
		<h4>Record fields & order</h4>
		<ul class="list-inline">
			<li class="go-green"><i class="fa fa-table"></i> id</li>
			<li class="go-green"><i class="fa fa-table"></i> name</li>
		</ul>

		<h4 style="margin-top:30px;">Records count</h4>
		<p class="text-muted">This will export a number of records based on the current list filter and sort</p>
		<div class="row">
			<div class="col-xs-6">
				<label class="radio-inline">
					<input type="radio" name="countOptions" ng-model="popupData.countHasSize" ng-value="true" style="top:6px;"> get the first <input class="form-control" ng-model="popupData.count" style="width:60px;display:inline-block;margin:0 5px;" /> records
				</label>
			</div>
			<div class="col-xs-6" style="padding:6px;">
				<label class="radio-inline">
					<input type="radio" name="countOptions" ng-model="popupData.countHasSize" ng-value="false"> get all records
				</label>
			</div>
		</div>
	</div>
	<div class="modal-body ng-hide" ng-show="popupData.downloadFilePath">
		<div class="go-green">Success!</div>
		<p>Click on the link bellow in the next 1 hour to download the report. Please have in mind that this link is only for your personal use.</p>
		<div class="form" style="margin:15px 0"><a href="{{popupData.downloadFilePath}}"><i class="fa fa-file"></i> click here to download the export file</a></div>
	</div>
	<div class="modal-footer">
		<a href="javascript:void(0)" ng-click="popupData.ok()" class="btn btn-primary ng-hide" ng-show="!popupData.downloadFilePath"><i class="fa fa-fw" ng-class="{'fa-download': !popupData.loading, 'fa-spinner fa-spin':popupData.loading}"></i> Export</a>
		<a href="javascript:void(0)" ng-click="popupData.cancel()" class="btn btn-default">Cancel</a>
	</div>
</script>

<script type="text/ng-template" id="importModalContent.html">
	<div class="modal-header">
		<h4 class="modal-title">Import records</h4>
	</div>
	<div class="modal-body record-details">
		<div class="alert alert-danger ng-hide" ng-show="popupData.hasError" ng-bind="popupData.errorMessage"></div>
		<h4>Import CSV</h4>
		<p class="text-muted">
			The import CSV should have column names matching the names of the imported fields. The first column should be "id" matching the id of the record to be updated.
			If the 'id' of a record equals 'null', a new record will be created with the provided columns and default values for the missing ones. If "id" does not exists, validation error will be raised
		</p>
		<div class="form">
			<div class="editable-field field">
				<label class="control-label">Uploaded CSV file</label>
				<div>
					<a ng-show='!popupData.uploadedFilePath && popupData.uploadProgress == 0' href='javascript:void(0)' class='btn btn-default btn-sm ng-hide' ngf-select="popupData.upload(popupData.uploadedFile)" ngf-max-size="20MB"
					   ng-model='popupData.uploadedFile' ngf-multiple='false'>Browse</a>
					<div class="progress ng-hide" ng-show="!popupData.uploadedFilePath && popupData.uploadProgress > 0 && popupData.uploadProgress <= 100">
						<div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="{{popupData.uploadProgress}}" aria-valuemin="0" aria-valuemax="100" ng-style="{'width': popupData.uploadProgress+'%'}">
							<span ng-show="popupData.uploadProgress < 100">{{popupData.uploadProgress || '0'}}%</span>
							<span ng-show="popupData.uploadProgress == 100">almost done...</span>
						</div>
					</div>
					<div class="input-group file-upload ng-hide" ng-show='popupData.uploadedFilePath'>
						<span class="form-control"><a href="{{popupData.uploadedFilePath}}"><i class="fa fa-file"></i> {{popupData.uploadedFile.name}}</a></span>
						<a class="input-group-addon update" href='javascript:void(0)' ngf-select="popupData.upload(popupData.uploadedFile)" ngf-max-size="20MB" ng-model='popupData.uploadedFile' ngf-multiple='false'><i class="fa fa-fw fa-refresh"></i></a>
						<a class="input-group-addon delete" href="javascript:void(0)" confirmed-click="popupData.deleteFileUpload()" ng-confirm-click="Are you sure?" title="delete file"><i class="fa fa-fw fa-trash-o"></i></a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<a href="javascript:void(0)" ng-click="popupData.ok()" class="btn btn-primary"><i class="fa fa-fw" ng-class="{'fa-upload': !popupData.loading, 'fa-spinner fa-spin':popupData.loading}"></i> Import</a>
		<a href="javascript:void(0)" ng-click="popupData.cancel()" class="btn btn-default">Cancel</a>
	</div>
</script>